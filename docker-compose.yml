version: '3'
networks:
    custom-metrics-monitoring:
        driver: bridge
        driver_opts: 
            com.docker.network.enable_ipv6: "false"
        ipam:
            driver: default
            config:
            - subnet: 172.18.0.0/16

services:
    prometheus:
        image: prom/prometheus:v2.20.1
        container_name: prometheus
        volumes:
            - ./prometheus.yml:/etc/prometheus/prometheus.yml
            - ./targets.json:/etc/prometheus/targets.json
        command:
            - '--config.file=/etc/prometheus/prometheus.yml'
        ports:
            - "9090:9090"
        networks:
            custom-metrics-monitoring:
                ipv4_address: 172.18.0.3
    
    grafana:
        image: grafana/grafana:7.1.3
        container_name: grafana
        environment:
            - GF_SECURITY_ADMIN_PASSWORD=admin
        depends_on:
            - prometheus
        ports:
            - "3000:3000"
        networks:
            custom-metrics-monitoring:
                ipv4_address: 172.18.0.4
    
    custom-metrics:
        image: eminaktas/get-of-metrics:3.0.0
        container_name: custom-metrics
        volumes:
            - ./connection-parameters.json:/get-of-metrics/connection-parameters.json
            - ./logs:/get-of-metrics/logs
        ports: 
            - "8000:8000"
        networks:
            custom-metrics-monitoring:
                ipv4_address: 172.18.0.5